# Протокольная документация

## Обзор

Этот протокол обеспечивает взаимодействие между клиентом на JavaScript и сервером на Go с использованием сообщений в формате JSON. Коммуникация следует предопределенному потоку состояний для управления взаимодействием между клиентом и сервером, обрабатывая различные состояния: `start`, `set`, `finish` и `result`.

## Структура сообщения

Каждое сообщение следует общему формату:

```json
{
    "state": "<state>",
    "date": {
        // Данные, специфичные для состояния
    }
}
```

- **state**: Представляет текущее состояние взаимодействия.
- **date**: Содержит полезную нагрузку с дополнительной информацией, относящейся к текущему состоянию.

## Состояния

### 1. Состояние: `start`

Клиент отправляет сообщение `start` для инициации взаимодействия с сервером. Это сообщение указывает `path`.

- **Направление**: Клиент (JS) → Сервер (Go)

- **Формат сообщения**:
  ```json
  {
      "state": "start",
      "date": {
          "path": "/bla-bla-bla"
      }
  }
  ```

- **Поля**:
    - `path`: Конкретный путь или конечная точка, которые инициирует клиент.

### 2. Состояние: `set`

Сервер отвечает сообщением `set`, предоставляя клиенту количество и вариации значений.

- **Направление**: Сервер (Go) → Клиент (JS)

- **Формат сообщения**:
  ```json
  {
      "state": "set",
      "date": {
          "count": 6,
          "variation": [1, 2, 3, 3, 2, 1]
      }
  }
  ```

- **Поля**:
    - `count`: Количество значений в массиве вариаций.
    - `variation`: Массив целых чисел, представляющих последовательность значений.

### 3. Состояние: `finish`

Клиент отправляет сообщение `finish`, чтобы указать завершение задачи, передавая количество кликов и время, затраченное на выполнение.

- **Направление**: Клиент (JS) → Сервер (Go)

- **Формат сообщения**:
  ```json
  {
      "state": "finish",
      "date": {
          "clicks": 5,
          "time": 105
      }
  }
  ```

- **Поля**:
    - `clicks`: Количество кликов, выполненных пользователем.
    - `time`: Время, затраченное пользователем (в секундах или миллисекундах).

### 4. Состояние: `result`

Сервер отвечает сообщением `result`, предоставляя клиенту результат или сводку по задаче.

- **Направление**: Сервер (Go) → Клиент (JS)

- **Формат сообщения**:
  ```json
  {
      "state": "result",
      "date": {
          "message": "лучший результат — 5"
      }
  }
  ```

- **Поля**:
    - `message`: Сводное сообщение или результат, предоставленный сервером.

## Поток состояний

1. **Start**: Клиент отправляет серверу сообщение `start`, чтобы начать взаимодействие.
2. **Set**: Сервер отвечает сообщением `set`, предоставляя клиенту соответствующие данные (например, количество, вариации).
3. **Finish**: После завершения задачи клиент отправляет сообщение `finish` серверу, предоставляя количество кликов и затраченное время.
4. **Result**: Сервер отправляет сообщение `result` клиенту, подводя итог (например, лучший результат).

## Пример взаимодействия

1. **Клиент → Сервер**: Клиент инициализирует процесс, отправляя сообщение `start`.
2. **Сервер → Клиент**: Сервер отвечает сообщением `set`, содержащим данные для клиента.
3. **Клиент → Сервер**: Когда клиент завершает задачу, он отправляет сообщение `finish` с метриками производительности.
4. **Сервер → Клиент**: Сервер оценивает данные и отправляет сообщение `result`, подводя итог выполнения.

## Обработка ошибок (опционально)

Если состояние отправлено в неожиданном порядке или содержит недопустимые данные, сервер может отправить сообщение об ошибке с соответствующим сообщением, например:

```json
{
    "state": "error",
    "date": {
        "message": "Неверный переход состояния или данные"
    }
}
